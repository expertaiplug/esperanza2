<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esperanza - Immigration Support & Rights Education</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet" />
    <style>
        :root {
            --sage-light: #e8f3ed;
            --sage-medium: #d8ede2;
            --sage-deep: #a8d5ba;
            --gold-light: #f8f4ed;
            --gold-medium: #f0e6d2;
            --gold-warm: #e6d5b7;
            --terracotta-soft: #f4e6db;
            --terracotta-medium: #e6d5c7;
            --terracotta-deep: #c4a484;
            --clay-warm: #d4b59e;
            --earth-brown: #8b6f47;
            --soft-cream: #fefbf7;
            --glass-white: rgba(255, 255, 255, 0.15);
            --glass-sage: rgba(216, 237, 226, 0.25);
            --glass-terracotta: rgba(228, 213, 199, 0.25);
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            --border-glass: rgba(255, 255, 255, 0.2);
            --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.08);
            --shadow-float: 0 12px 40px rgba(0, 0, 0, 0.12);
            --blur-glass: blur(16px);
            --warm-support: #8fbc8f;
            --trust-brown: #a67c52;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--sage-light) 0%, var(--terracotta-soft) 30%, var(--gold-light) 70%, var(--sage-medium) 100%);
            background-attachment: fixed;
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Gentle Header */
        .header {
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: var(--blur-glass);
            background: var(--glass-white);
            border-bottom: 1px solid var(--border-glass);
            padding: 1rem 0;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .privacy-badge {
            background: var(--glass-terracotta);
            border: 1px solid var(--border-glass);
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .language-toggle {
            background: var(--glass-white);
            border: 1px solid var(--border-glass);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .language-toggle:hover {
            background: var(--glass-terracotta);
        }

        /* Hero Section - Calm & Professional */
        .hero {
            min-height: 80vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 3rem 2rem;
            position: relative;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 20%, var(--glass-sage) 0%, transparent 50%),
                        radial-gradient(circle at 70% 80%, var(--glass-terracotta) 0%, transparent 50%);
            pointer-events: none;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 800px;
        }

        .credentials-badge {
            display: inline-block;
            background: var(--glass-white);
            backdrop-filter: var(--blur-glass);
            border: 1px solid var(--border-glass);
            padding: 0.6rem 1.5rem;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            letter-spacing: 0.025em;
        }

        .hero-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--earth-brown);
            box-shadow: var(--shadow-soft);
            margin: 0 auto 2rem;
        }

        .hero-title {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2.5rem, 5vw, 3.5rem);
            font-weight: 600;
            line-height: 1.2;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .hero-subtitle {
            font-size: 1.3rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .hero-experience {
            font-size: 1rem;
            color: var(--text-muted);
            margin-bottom: 2rem;
        }

        .hero-description {
            font-size: 1.1rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto 3rem;
            line-height: 1.7;
        }

        /* Trust Indicators - Subtle */
        .trust-row {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .trust-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
            background: var(--glass-white);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            border: 1px solid var(--border-glass);
        }

        /* How It Works - Gentle Explanation */
        .how-it-works {
            padding: 4rem 2rem;
            max-width: 1000px;
            margin: 0 auto;
        }

        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            text-align: center;
            margin-bottom: 3rem;
            color: var(--text-primary);
        }

        .how-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .how-step {
            background: var(--glass-white);
            backdrop-filter: var(--blur-glass);
            border: 1px solid var(--border-glass);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            transition: all 0.4s ease;
        }

        .how-step:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-float);
        }

        .step-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            display: block;
        }

        .step-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.3rem;
            font-weight: 500;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .step-description {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .gentle-note {
            background: var(--glass-terracotta);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            color: var(--text-secondary);
            font-style: italic;
            border: 1px solid var(--border-glass);
        }

        /* Support Options - Calm Tabs */
        .support-section {
            padding: 4rem 2rem;
            max-width: 1000px;
            margin: 0 auto;
        }

        .tab-navigation {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
            background: var(--glass-white);
            border-radius: 25px;
            padding: 0.5rem;
            border: 1px solid var(--border-glass);
            overflow-x: auto;
        }

        .tab-btn {
            background: transparent;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 20px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.95rem;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab-btn.active {
            background: var(--earth-brown);
            color: white;
        }

        .tab-btn:hover:not(.active) {
            background: var(--glass-terracotta);
        }

        .tab-content {
            display: none;
            background: var(--glass-white);
            backdrop-filter: var(--blur-glass);
            border: 1px solid var(--border-glass);
            border-radius: 20px;
            padding: 2.5rem;
            min-height: 400px;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tab-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .tab-description {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .support-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
        }

        .support-card {
            background: var(--glass-terracotta);
            border: 1px solid var(--border-glass);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .support-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-soft);
        }

        .card-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
            display: block;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .card-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Chat Interface - Mobile-like */
        .chat-container {
            background: var(--glass-white);
            border: 1px solid var(--border-glass);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            max-height: 500px;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-glass);
            margin-bottom: 1rem;
        }

        .esperanza-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--earth-brown);
        }

        .chat-info h4 {
            font-family: 'Playfair Display', serif;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
            color: var(--text-primary);
        }

        .chat-status {
            font-size: 0.85rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--warm-support);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 1rem;
        }

        .chat-message {
            background: var(--glass-terracotta);
            border-radius: 18px 18px 4px 18px;
            padding: 1rem 1.25rem;
            margin-bottom: 1rem;
            font-size: 0.95rem;
            line-height: 1.6;
            color: var(--text-secondary);
            border: 1px solid var(--border-glass);
            max-width: 85%;
        }

        .chat-input-area {
            display: flex;
            gap: 0.75rem;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            background: var(--glass-white);
            border: 1px solid var(--border-glass);
            border-radius: 20px;
            padding: 0.75rem 1rem;
            font-size: 0.95rem;
            font-family: inherit;
            color: var(--text-primary);
            resize: none;
            min-height: 44px;
            max-height: 120px;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--earth-brown);
            box-shadow: 0 0 0 3px rgba(139, 111, 71, 0.1);
        }

        .chat-send {
            background: var(--earth-brown);
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .chat-send:hover {
            transform: scale(1.05);
        }

        /* Resource Section */
        .resources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .resource-card {
            background: var(--glass-white);
            border: 1px solid var(--border-glass);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .resource-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-soft);
        }

        .resource-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .resource-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 1rem;
        }

        .resource-contact {
            font-size: 0.85rem;
            color: var(--text-muted);
            padding: 0.5rem;
            background: var(--glass-terracotta);
            border-radius: 8px;
        }

        /* Footer - Gentle */
        .footer {
            background: var(--glass-white);
            backdrop-filter: var(--blur-glass);
            border-top: 1px solid var(--border-glass);
            padding: 3rem 2rem 2rem;
            margin-top: 4rem;
        }

        .footer-content {
            max-width: 1000px;
            margin: 0 auto;
            text-align: center;
        }

        .footer-quote {
            font-family: 'Playfair Display', serif;
            font-size: 1.2rem;
            font-style: italic;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        .footer-disclaimer {
            font-size: 0.85rem;
            color: var(--text-muted);
            line-height: 1.5;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .hero {
                padding: 2rem 1rem;
                min-height: 70vh;
            }

            .how-steps {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .tab-navigation {
                overflow-x: auto;
                justify-content: flex-start;
            }

            .tab-content {
                padding: 2rem;
            }

            .trust-row {
                flex-direction: column;
                align-items: center;
                gap: 1rem;
            }

            .nav-container {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .hero {
                padding: 1.5rem 1rem;
            }

            .how-it-works,
            .support-section {
                padding: 3rem 1rem;
            }

            .tab-content {
                padding: 1.5rem;
            }

            .chat-container {
                padding: 1.5rem;
            }
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        .tab-btn:focus,
        .support-card:focus,
        .chat-send:focus {
            outline: 2px solid var(--earth-brown);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <!-- Gentle Header -->
    <header class="header">
        <div class="nav-container">
            <div class="logo">
                🌿 Esperanza
            </div>
            <div class="privacy-badge">
                🔒 Private & Safe
            </div>
            <div class="language-toggle">
                🌐 Español
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <div class="credentials-badge">Immigration Justice Advocate • JD/MSW • 18+ Years Experience</div>
            
            <img src="https://images.unsplash.com/photo-1594736797933-d0401ba2fe65?w=300&h=300&fit=crop&crop=face" 
                 alt="Esperanza Morales-Santos" class="hero-photo">
            
            <h1 class="hero-title">Esperanza Morales-Santos</h1>
            <div class="hero-subtitle">Immigration Support & Rights Education</div>
            <div class="hero-experience">Current with 2025 Policy Changes</div>
            
            <p class="hero-description">
                A safe space for immigrant families to understand their rights, find support, and navigate current challenges with dignity and hope.
            </p>

            <div class="trust-row">
                <div class="trust-item">
                    <span>✨</span> No registration required
                </div>
                <div class="trust-item">
                    <span>🛡️</span> Rights education focus
                </div>
                <div class="trust-item">
                    <span>🤝</span> Community connections
                </div>
            </div>
        </div>
    </section>

    <!-- How It Works -->
    <section class="how-it-works">
        <h2 class="section-title">How I Support You</h2>
        
        <div class="how-steps">
            <div class="how-step">
                <span class="step-icon">💬</span>
                <h3 class="step-title">Share What's Happening</h3>
                <p class="step-description">
                    Tell me about your situation - no personal details needed. Just what you're experiencing or worried about.
                </p>
            </div>
            
            <div class="how-step">
                <span class="step-icon">🛡️</span>
                <h3 class="step-title">Understand Your Rights</h3>
                <p class="step-description">
                    I'll explain your current protections and options based on what's happening in 2025, in clear language.
                </p>
            </div>
            
            <div class="how-step">
                <span class="step-icon">🌐</span>
                <h3 class="step-title">Connect to Support</h3>
                <p class="step-description">
                    When you need additional help, I'll connect you with trusted organizations and legal resources in your area.
                </p>
            </div>
        </div>

        <div class="gentle-note">
            💕 This is education and crisis support - not legal advice. For complex legal cases, I'll help you find qualified attorneys.
        </div>
    </section>

    <!-- Support Options -->
    <section class="support-section">
        <h2 class="section-title">How Can I Help You Today?</h2>
        
        <div class="tab-navigation">
            <button class="tab-btn active" onclick="showTab('rights')">Know Your Rights</button>
            <button class="tab-btn" onclick="showTab('support')">Find Support</button>
            <button class="tab-btn" onclick="showTab('chat')">Talk with Me</button>
        </div>

        <!-- Rights Tab -->
        <div class="tab-content active" id="rights-tab">
            <h3 class="tab-title">🛡️ Understanding Your Rights</h3>
            <p class="tab-description">
                Current protections and guidance based on 2025 policies. Knowledge is power, and you have more rights than you might think.
            </p>
            
            <div class="support-options">
                <div class="support-card" onclick="startChat('home-visits')">
                    <span class="card-icon">🏠</span>
                    <h4 class="card-title">If Someone Comes to Your Home</h4>
                    <p class="card-description">What to do, what to say, and what your rights are</p>
                </div>
                
                <div class="support-card" onclick="startChat('work-concerns')">
                    <span class="card-icon">💼</span>
                    <h4 class="card-title">Workplace Concerns</h4>
                    <p class="card-description">Your rights at work and how to protect yourself</p>
                </div>
                
                <div class="support-card" onclick="startChat('family-safety')">
                    <span class="card-icon">👨‍👩‍👧‍👦</span>
                    <h4 class="card-title">Protecting Your Family</h4>
                    <p class="card-description">Emergency planning and keeping families together</p>
                </div>
                
                <div class="support-card" onclick="startChat('daily-life')">
                    <span class="card-icon">🚗</span>
                    <h4 class="card-title">Daily Life Safety</h4>
                    <p class="card-description">School, healthcare, driving, and community activities</p>
                </div>
            </div>
        </div>

        <!-- Support Tab -->
        <div class="tab-content" id="support-tab">
            <h3 class="tab-title">🤝 Find Local Support</h3>
            <p class="tab-description">
                Connect with trusted organizations, legal aid, and community resources that understand your situation.
            </p>
            
            <div class="resources-grid">
                <div class="resource-card">
                    <h4 class="resource-title">Legal Aid Organizations</h4>
                    <p class="resource-description">Free and low-cost legal help for immigration matters</p>
                    <div class="resource-contact">I can help you find local options</div>
                </div>
                
                <div class="resource-card">
                    <h4 class="resource-title">Community Organizations</h4>
                    <p class="resource-description">Local groups providing support, resources, and advocacy</p>
                    <div class="resource-contact">Area-specific connections available</div>
                </div>
                
                <div class="resource-card">
                    <h4 class="resource-title">Emergency Support</h4>
                    <p class="resource-description">Crisis hotlines and immediate assistance programs</p>
                    <div class="resource-contact">National Immigration Legal Helpline: 1-855-643-5297</div>
                </div>
                
                <div class="resource-card">
                    <h4 class="resource-title">Know Your Rights Workshops</h4>
                    <p class="resource-description">Community education and empowerment sessions</p>
                    <div class="resource-contact">Local workshop schedules available</div>
                </div>
            </div>
        </div>

        <!-- Chat Tab -->
        <div class="tab-content" id="chat-tab">
            <h3 class="tab-title">💬 Talk with Esperanza</h3>
            <p class="tab-description">
                Ask me anything about your situation. I'm here to listen, provide guidance, and connect you with resources when you need them.
            </p>
            
            <div class="chat-container">
                <div class="chat-header">
                    <img src="https://images.unsplash.com/photo-1594736797933-d0401ba2fe65?w=100&h=100&fit=crop&crop=face" 
                         alt="Esperanza" class="esperanza-avatar">
                    <div class="chat-info">
                        <h4>Esperanza</h4>
                        <div class="chat-status">
                            <span class="status-dot"></span>
                            Here to support you
                        </div>
                    </div>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <div class="chat-message">
                        Hello, and welcome to this safe space. I understand that reaching out can feel scary, especially right now. I'm here to help you understand your rights and find support, with no judgment and complete privacy. What's on your mind today? 💙
                    </div>
                </div>
                
                <div class="chat-input-area">
                    <textarea class="chat-input" id="chatInput" 
                              placeholder="Share what's on your mind..."
                              rows="1"></textarea>
                    <button class="chat-send" onclick="sendMessage()" aria-label="Send message">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-quote">
                "Every person deserves dignity, safety, and the opportunity to build a better life for their family."
            </div>
            <div class="footer-disclaimer">
                This tool provides education and crisis support. For legal representation in complex cases, 
                I'll help connect you with qualified immigration attorneys. Your privacy and safety are protected - 
                no personal information is collected or stored.
            </div>
        </div>
    </footer>

    <script>
        // Tab functionality
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }

        // Chat functionality
    // Chat functionality - COMPLETE VERSION
// Enhanced chat functionality calling Netlify function
async function sendMessage() {
    const input = document.getElementById('chatInput');
    const messagesContainer = document.getElementById('chatMessages');
    const message = input.value.trim();

    if (!message) return;

    // Add user message
    const userMessage = document.createElement('div');
    userMessage.style.cssText = `
        background: var(--earth-brown);
        color: white;
        border-radius: 18px 18px 18px 4px;
        padding: 1rem 1.25rem;
        margin-bottom: 1rem;
        margin-left: auto;
        max-width: 85%;
        font-size: 0.95rem;
        line-height: 1.6;
    `;
    userMessage.textContent = message;
    messagesContainer.appendChild(userMessage);

    // Clear input
    input.value = '';
    input.style.height = 'auto';

    // Show typing indicator
    const typingIndicator = document.createElement('div');
    typingIndicator.className = 'chat-message';
    typingIndicator.innerHTML = '💭 Esperanza is analyzing your situation...';
    messagesContainer.appendChild(typingIndicator);

    // Scroll to bottom
    messagesContainer.scrollTop = messagesContainer.scrollHeight;

    try {
        // Call YOUR Netlify function
        const response = await fetch('/.netlify/functions/esperanza', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ 
                message: message,
                conversation_history: [] // Add conversation tracking if needed
            })
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        console.log('Response data:', data);
        
        // Remove typing indicator
        typingIndicator.remove();
        
        // Add Esperanza's response
        const responseMessage = document.createElement('div');
        responseMessage.className = 'chat-message';
        responseMessage.innerHTML = data.reply || 'I had trouble processing that. Can you try again?';
        messagesContainer.appendChild(responseMessage);
        
        messagesContainer.scrollTop = messagesContainer.scrollHeight;

    } catch (error) {
        console.error('Error:', error);
        
        // Remove typing indicator
        typingIndicator.remove();
        
        // Show error message
        const errorMessage = document.createElement('div');
        errorMessage.className = 'chat-message';
        errorMessage.innerHTML = `I'm having technical difficulties right now, but I'm still here with you in spirit. If you're in crisis: National Immigration Legal Helpline at 1-855-NIF-LAWS (1-855-643-5297). 💙`;
        messagesContainer.appendChild(errorMessage);
        
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
}

// Rest of your client-side code stays the same...
document.addEventListener('DOMContentLoaded', function() {
    const chatInput = document.getElementById('chatInput');
    if (chatInput) {
        chatInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });

        chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
    }

    // Initialize with full Esperanza introduction
    const messagesContainer = document.getElementById('chatMessages');
    if (messagesContainer && messagesContainer.children.length === 1) {
        const welcomeMessage = messagesContainer.querySelector('.chat-message');
        if (welcomeMessage) {
            welcomeMessage.innerHTML = `Hola, I'm Esperanza. This is a safe space to ask questions about your rights and find support. 

How can I help you today? 💙`;
        }
    }
});

function showTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    document.getElementById(tabName + '-tab').classList.add('active');
    event.target.classList.add('active');
}

function startChat(topic) {
    showTab('chat');
    
    const input = document.getElementById('chatInput');
    const topicMessages = {
        'home-visits': "I'm worried about what to do if ICE comes to my home. Can you help me understand my rights and make a plan?",
        'work-concerns': "I'm concerned about my rights at work and what my employer can and can't do",
        'family-safety': "I need help protecting my family and preparing for what might happen", 
        'daily-life': "I have questions about staying safe during daily activities like school, healthcare, and driving"
    };
    
    if (topicMessages[topic]) {
        input.value = topicMessages[topic];
        input.focus();
    }
}
    // Scroll to bottom
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
}
    </script>
